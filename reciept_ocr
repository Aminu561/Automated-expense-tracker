from PIL import Image
import pytesseract
import os

class ReceiptProcessor:
    def __init__(self, tesseract_path=None):
        """
        Initializes the ReceiptProcessor.
        Args:
            tesseract_path (str, optional): The path to the tesseract executable.
                                           This is needed if it's not in your system's PATH.
        """
        # If a tesseract path is provided, set it.
        if tesseract_path:
            pytesseract.pytesseract.tesseract_cmd = tesseract_path
        
        # Check if the Tesseract executable is accessible.
        try:
            pytesseract.get_tesseract_version()
            print("Tesseract engine found and ready.")
        except pytesseract.TesseractNotFoundError:
            print("Tesseract engine not found. Please ensure it's installed and in your system's PATH.")
            print("You may need to provide the path manually during class initialization.")
            # We can still proceed, but the processing will fail.
            # A more robust solution would be to raise an exception.

    def extract_text_from_image(self, image_path):
        """
        Extracts text from a receipt image using Tesseract OCR.
        
        Args:
            image_path (str): The file path to the receipt image.
            
        Returns:
            str: The extracted text as a string, or None if an error occurs.
        """
        # Ensure the file exists before trying to open it.
        if not os.path.exists(image_path):
            print(f"Error: Image file not found at {image_path}")
            return None
            
        try:
            # Open the image file using Pillow.
            img = Image.open(image_path)
            
            # Use pytesseract to extract text.
            text = pytesseract.image_to_string(img)
            
            return text
        except Exception as e:
            # Catch and report any other exceptions, like issues with the image file itself.
            print(f"Error during OCR processing: {e}")
            return None

# --- Example Usage ---

# 1. Initialize the class.
# If you have Tesseract in your system PATH, you can simply do:
# processor = ReceiptProcessor()

# If not, you'll need to specify the path to the executable.
# For example, on Windows:
# tesseract_exec_path = r'C:\Program Files\Tesseract-OCR\tesseract.exe'
# For example, on macOS/Linux (after brew/apt-get):
tesseract_exec_path = r'C:\Program Files\Tesseract-OCR\tesseract.exe' # This is a common path
processor = ReceiptProcessor(tesseract_path=tesseract_exec_path)

# 2. Use the method to extract text from a file.
# Make sure you have a receipt image file in your project directory.
image_file_path = "my_receipt.jpg"

extracted_text = processor.extract_text_from_image(image_file_path)

if extracted_text:
    print("--- Extracted Text ---")
    print(extracted_text)
else:
    print("Failed to extract text from the image.")